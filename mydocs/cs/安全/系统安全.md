<p align="center">
	<strong><font size="6">系统安全</font></strong>
</p>

# 安全管理

## PDCA 模型

信息安全管理的程序遵循 PDCA 循环模式：

1. 计划：建立与组织总体战略、目标和方针保持在一致的信息安全管理方针、策略，通过风险评估建立控制目标和方式，制定风险处理计划。

2. 实施：按照控制目标和方式实施信息安全管理，开展全员培训、实施安全控制。

3. 检查：对照信息安全管理体系方针、目标对信息安全管理进行监事和验证，评审 ISMS 的有效性和适当性。

4. 处理：基于上述对体系的内部审核和管理评价结果，采取纠正和预防措施，以持续改进组织的信息安全管理体系。


ISO/IEC27001:2013(GB/T 29246- 2017) 中通过融合 PDCA 思想。提出了信息安全管理体系的运行流程，将其细分成了七个部分：

* **计划（Plan）**

  组织环境、领导力、计划、支持

* **执行（Do）**

  实施和运行

* **检查（Check）**

  监事和评审

* **处理（Act）**

  维护和改进

![](image/Pasted%20image%2020220630221706.png)

第一步：


![](image/Pasted%20image%2020220630222914.png)


第二步：

![](image/Pasted%20image%2020220630222939.png)


## 工作组、域和信任关系

**工作组（workgroup）**

* 为小型办公系统提供了资源共享功能，使用户可共享其他计算机上的本地资源。
* 适用于小型工作环境，不进行集中控制。用户增多时难以管理。
* 不共享任何用户账户信息和组账户信息，每个系统使用自身的 SAM(security account manager) 数据库独立验证。

**域（domain）**

域是一批具有集中安全授权机构和若干台工作站和成员服务器的计算机集合。

* 域为用户，组和计算机账户定义了管理边界范围。
* 一个域中的所有用户共享域用户账户数据库和普通的安全策略。
* 每台计算机不需要提供自己的验证服务，一旦用户用域验证服务通过验证，就可以在域内访问权限内资源了。

> 域中的几种逻辑结构
> 
> * 单域：建立一个域就可以满足需求。
> * 组织单元：可连接组策略，是委派管理权限的最小分组。
> * 域树：具有连续的命名空间（即有相同的上级域名）的多个域称为树。
> * 域森林：不构成连续命名空间的域树的集合，这些目录树通过可传递信任关系链接在一起。

**信任关系**

当网络更大时，可以使用信任关系来创建并链接多个域。

* 信任关系是域之间的关系  
  当域之间建立了信任关系后，一个域就可以信任另一个域中的用户访问自己的资源，而又不必在本域中拥有这个用户的账户和口令。
* 信任关系的好处  
  实现跨域的集中安全验证，支持用户的单一登录。
* 信任关系的种类

	* 单向信任关系：信任域 $\longrightarrow$ 受信任域
	* 双向信任关系：信任域 $\longleftrightarrow$ 受信任域

**域和工作区对比**

* 域可定义安全管理边界，工作组无集中管理，相互独立。
* 验证：  
	域验证时每台计算机不需要提供自己的验证服务，工作组中登录验证用的是本机的验证服务。
* 登录成功访问范围：
  域在整个受信任域中访问许可的资源，工作组为本机资源。

## 活动目录关键机制

活动目录（Active Directory, AD）是指域环境中提供目录服务的的组件。

### 单点登陆（Kerberos）

用户只需登录一次就可以访问所有相互信任的应用系统的保护资源。

![](image/Pasted%20image%2020220702161706.png)

### 全局目录（GC）

全局编录是一个域树或者域森林中的所有对象信息的中心仓库，记录了 AD 中的所有域对象的部分信息以及架构信息和配置信息的完整副本。

每个域控制器保存的信息：

* 域数据：包含该域内所有对象信息，这些信息被复制到该域的每个域域控制器。
* 架构数据：定义了 AD 中存储哪些对象、属性和操作规则，属于目录林的范畴。
* 配置数据：定义了复制拓扑及 AD 配置有关的其他数据，对域森林中的所有域通用，也被复制到森林的所有域控制器。

如果域控制器是 GC 服务器，还将为所有域保存“域数据”的部分副本，GC 保存的属性的子集包括在搜索操作中最常用的属性。

全局目录执行两个关键目录任务：

* 客户登录时向域控制器提供通用组成员信息，用户登录网络时必须存在一台 GC，否则只能登录到本地。
* 客户查询目录信息时：用户在发出查询信息时首先会送到最近的 GC，通常 GC 可满足绝大多数查询，只有当查询对象的信息不在GC 中时服务器才会将查询转至对象所在域，从而实现跨所有域的搜索。

### 智能信息复制（多主复制）

通过安装域控制器，可在整个网络环境中创建目录的多份副本。

网络任何地方发生变化都会在整个网络中自主复制，保证数据一致性。

### 组策略

* 组策略设置对象

* 组策略处理和优先级

* 组策略冲突的解决方法


# 公钥基础设施

## PKI 架构

Public Key Infrastructure, PKI 的基本组件：

* 认证机构（Certificate Authority, CA）：是 PKI 中受信任的第三方实体，是信任的起点，向主体颁发证书、证书吊销列表 CRL、续借和更新证书。
* 数字证书（Digitial Certificate）

其他组件：

* 注册机构 RA：用于证书登记过程中核实证书申请者的身份，有的架构中 CA 也委派给 RA  一些其他任务，比如个人认证、吊销报告、密钥生成、存储密钥对。
* 档案库：存储和保护充足的信息来决定在一份旧的文档中数字签名是可信任的。
* 密钥备份及恢复系统：只能对解密私钥，签名私钥不能备份。

PKI 可以实现机密性、认证性、完整性和不可否认性。

## 数字证书及证书验证

证书中最重要的信息有主体名、公钥以及认证机构的签名、算法和用途。

证书的结构：

![](image/Pasted%20image%2020220701151739.png)

一个证书的例子：

![](image/Pasted%20image%2020220701202806.png)

证书的撤销方法：

1. 周期发布机制
2. 在线查询机制：证书状态的在线查询向 OCSP 服务器发送 OCSP 查询包，包中含有证书的序列号，验证时间戳。

证书的认证：

1. 验证真实性：证书是否为可信任的 CA 认证中心签发。
2. 验证有效性：证书是否在证书的有效使用期之内。
3. 验证可用性：证书是否已经废除。
4. 验证证书结构中的证书用途。

## PKI 的安全性

* 对证书传输过程的攻击
* 对 CA 认证过程的攻击
* 对 CA 签名过程的攻击
* 对算法的攻击
* 对用户确认的攻击

# 身份认证

* 实体身份认证
* 消息认证

## 基于文本口令的认证

### 对文本口令的攻击

* 字典或穷举攻击、社会工程、窥探

* 截取或重放攻击

### 口令安全

* 基于单向函数的口令存放，口令 Hash 散列存储。可防御离线字典、穷举攻击。

![](image/Pasted%20image%2020220701170218.png)

* 加盐 + 单向散列存放。口令和一个随机数盐值作为散列函数的输入，最终生成一个定长的散列码。

	* 可防止复制的口令在口令文件中出现。
	* 显著增加了离线口令字典攻击的难度。
	* 攻击者不能发现一个用户在多个系统中使用的相同口令。
	
* 强口令设置，针对字典、穷举攻击。

	* 口令设置策略：约束口令满足复杂度要求，即不少于 8 个字符，其中包括大小写字母、数组和特殊符号。
	* 设置口令允许登录的次数，防止在线字典攻击或暴力破解；设置最长使用期限，需要定期更换口令。

### 利用验证码增强安全性

验证码是一种逆图灵测试，作用是防止攻击者使用自动程序在短时间内进行重复大量的操作。

> 图灵测试由图灵提出，如果一台计算机能和人类对话而不被识别出是机器则被认为机器通过了图灵测试。  
> 逆图灵测试是区分人与机器的方法，因为人类很容易通过测试而对于自动程序来说很难通过。

## 基于密码学的认证

消息认证包含三种安全服务：

* 保证信息的完整性
* 验证信息发送者身份
* 防止信息发送者抵赖
 
### 基于对称密码算法的机制

实体 A 和 B 在开始具体运行认证机制之前应共享一个公共的秘密密钥 K 对消息 M 进行加密和认证，M 具有特定的结构，可以自动检测报文是否被更改。

![](image/Pasted%20image%2020220701182308.png)
* 实现了消息认证：

	* 认证性：只能来自 A
	* 完整性：M 有特定的结构，传输过程中没有被篡改

* 机密性：只有 A 和 B 知道 K

Kerbores 机制

### 基于 MAC 码的机制

利用共享密钥来生成固定长度的数据块成为消息认证码 MAC，MAC 一般使用哈希算法（单向函数）生成 $MAC=F(K_{AB}, M)$，在算法上是不可逆的。

通信双方使用共享密钥，接受者对受到的消息也使用同样的算法计算，并和收到的 MAC 进行匹配，即可确保数据来自声称的发送者且传输过程中没有被篡改。

MAC 可提供完整性服务和发送者认证性服务。

![](image/Pasted%20image%2020220701183238.png)


HMAC（键控散列消息认证）是最受欢迎的，被强制用于 IP 安全，也用于 TLS 和 SET 协议以及 NTLM 认证协议。

![](image/Pasted%20image%2020220701183525.png)

### 基于非对称密码（数字签名）算法的机制

如果发送方使用公钥加密消息，仅仅可以保证机密性，无法实现消息认证所包含的其他任何一项安全服务。 

![](image/Pasted%20image%2020220701210632.png)

如果发送方使用私钥加密消息，则不会起到任何保密作用，因为任何人都知道公钥，但是可以实现消息认证所包含的三种安全服务：

* 完整性服务：传输过程中没有被篡改
* 认证性服务：只有 A 才有私钥
* 不可否认服务：可以使用 A 的公钥验证

![](image/Pasted%20image%2020220701210547.png)

故采取另一种思路：发送方**先使用私钥对消息进行加密，再使用接收方的公钥加密**，则既可以保证消息的机密性也实现了消息认证所包含的三种安全服务。

![](image/Pasted%20image%2020220701211512.png)

TLS 协议

### 认证与密钥交换协议设计中的问题

认证和密钥交换协议的核心问题有两个：保密性和时效性。

* 第一：认证和会话密钥信息必须以加密形式通信。这就要求预先存在保密或公开密钥供实现加密使用。
* 第二：防止消息重放攻击。对策是使用非重复值。

	* 序列号：需保持上次消息的序号
	* 时间戳：需要时钟同步，时间窗口
	* 随机数：挑战/应答模式适用于连接性应用
	* 计数器：发送方和接收方各维护一个计数器（硬件支持）

## 统一身份认证

# 访问控制

访问控制以身份认证为前提，是一种针对越权使用资源的防御措施，它的基本目标是防止对任何资源进行未授权的访问，保障资源只能被合法用户执行合法操作。访问控制对机密性、完整性起直接的作用。

**访问控制三要素：**

1. 主体（Subject）：对客体提出访问请求的主动实体
2. 客体（Object）：接受主体访问的被动实体，需要被保护的资源
3. 访问权限（Right）：主体对客体执行的动作，也称对客体的访问模式

授权：规定主体是否对客体拥有访问权限，通常形成一套访问规则集，被称为访问控制策略

<主体、客体、权限> $\longrightarrow$ <肯定/否定许可>

e.g. <Alice、 File1、 read> $\longrightarrow$ permit

## 自主访问控制 DAC

根据主体的身份及允许访问的权限进行决策，自主指的是主体能够自主地将自身具有的访问权限或其子集授予其他主体。

特点：

* 灵活易行，适用于商业和工业环境
* 权限的授予可传递，一旦访问权被传递出去难以控制
* 信息在移动的过程中访问权限关系会被改变，不能对资源提供充分的保护，不能抵御特洛伊木马。

**访问控制矩阵**

根据访问控制三元组可以生成访问控制矩阵：

![](image/Pasted%20image%2020220702165502.png)

在大型系统中实现自主访问控制时，由于访问控制矩阵庞大而稀疏，搜索效率低下，因此使用基于矩阵的列或行来压缩信息：

* 基于列（客体）**major**
	
	* 访问控制表（Access Control List, ACL）
	* 基于保护位
	* 基于保护环

* 基于行（主体）
    
	* 能力表（Capabilities List, CL） 

### ACL

| |file1|file2|file3|
|-|-|-|-|
|Andy|rx|r|rwo|
|Betty|rwxo|r||
|...|...|...|...|

ACLs:

```bash
acl(file1) = {(Andy, rx), (Betty, rwxo)}
acl(file2) = {(Andy, r), (Betty, r)}
acl(file3) = {(Andy, rwo)}
```

### 保护位

如果主体很多，可以在访问控制列表中使用组来进行划分，不必包含单个发起者的身份。

在 UNIX/Linux 系统下某个目录使用 `ls -l` 命令即可显示出该目录下的所有文件的详细信息，最行表示一个文件的详细信息，最左侧显示的即为文件的类型和权限，使用如下格式进行表示：

![](image/Pasted%20image%2020220702173150.png)


### CL

| |file1|file2|file3|
|-|-|-|-|
|Andy|rx|r|rwo|
|Betty|rwxo|r||
|...|...|...|...|

CLs:

```bash
cap(Andy) = {(file1, rx), (file2, r), (file, rwo)}
cap(Betty) = {(file1, rwxo), (file2, r)}
```

CL 用的没有 ACL 多，因分布式系统中难以确定给客体的潜在主体集，CL 多用于分布式系统。

ACL 易于实现，多应用于集中式系统。

## 强制访问控制 MAC

### 基本原理

一种基于规则的访问控制，主体和客体都被系统标记了固定的安全属性，用户不能任意改变主体或客体的安全属性。

多级安全策略就是一种强制访问控制策略。

### 机密性策略模型 BLP

### 完整性策略模型 Biba

### 混合策略模型 BN

## 基于角色的访问控制

## 基于属性的访问控制

## Windows 分布式访问控制授权管理

# 数据安全

## 数据存储加密

### 透明加解密的实现和密钥管理

## 系统可靠性与数据容错

### 数据备份策略以及 RAID 机制

### 数据恢复机制

## 数据库安全

## 隐私保护

### 去标志化

<!--
## 网络通信安全

### VPN

### 防火墙

### 入侵检测